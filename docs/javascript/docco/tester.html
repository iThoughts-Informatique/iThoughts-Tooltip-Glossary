<!DOCTYPE html>

<html>
<head>
  <title>tester.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="ithoughts_tt_gl-admin.html">
                  ithoughts_tt_gl-admin.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-atoz.html">
                  ithoughts_tt_gl-atoz.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-editor.html">
                  ithoughts_tt_gl-editor.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-floater.html">
                  ithoughts_tt_gl-floater.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-qtip2.html">
                  ithoughts_tt_gl-qtip2.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-styleeditor.html">
                  ithoughts_tt_gl-styleeditor.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-tinymce-forms.html">
                  ithoughts_tt_gl-tinymce-forms.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-tinymce.html">
                  ithoughts_tt_gl-tinymce.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-updater.html">
                  ithoughts_tt_gl-updater.js
                </a>
              
                
                <a class="source" href="bootstrap.html">
                  bootstrap.js
                </a>
              
                
                <a class="source" href="casperjs.html">
                  casperjs.js
                </a>
              
                
                <a class="source" href="style-switcher.html">
                  style-switcher.js
                </a>
              
                
                <a class="source" href="casper.html">
                  casper.js
                </a>
              
                
                <a class="source" href="cli.html">
                  cli.js
                </a>
              
                
                <a class="source" href="clientutils.html">
                  clientutils.js
                </a>
              
                
                <a class="source" href="colorizer.html">
                  colorizer.js
                </a>
              
                
                <a class="source" href="events.html">
                  events.js
                </a>
              
                
                <a class="source" href="http.html">
                  http.js
                </a>
              
                
                <a class="source" href="mouse.html">
                  mouse.js
                </a>
              
                
                <a class="source" href="pagestack.html">
                  pagestack.js
                </a>
              
                
                <a class="source" href="querystring.html">
                  querystring.js
                </a>
              
                
                <a class="source" href="tester.html">
                  tester.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="xunit.html">
                  xunit.js
                </a>
              
                
                <a class="source" href="bbcshots.html">
                  bbcshots.js
                </a>
              
                
                <a class="source" href="cliplay.html">
                  cliplay.js
                </a>
              
                
                <a class="source" href="customevents.html">
                  customevents.js
                </a>
              
                
                <a class="source" href="customlogging.html">
                  customlogging.js
                </a>
              
                
                <a class="source" href="download.html">
                  download.js
                </a>
              
                
                <a class="source" href="dynamic.html">
                  dynamic.js
                </a>
              
                
                <a class="source" href="each.html">
                  each.js
                </a>
              
                
                <a class="source" href="events.html">
                  events.js
                </a>
              
                
                <a class="source" href="extends.html">
                  extends.js
                </a>
              
                
                <a class="source" href="googlelinks.html">
                  googlelinks.js
                </a>
              
                
                <a class="source" href="googlematch.html">
                  googlematch.js
                </a>
              
                
                <a class="source" href="googlepagination.html">
                  googlepagination.js
                </a>
              
                
                <a class="source" href="googletesting.html">
                  googletesting.js
                </a>
              
                
                <a class="source" href="logcolor.html">
                  logcolor.js
                </a>
              
                
                <a class="source" href="metaextract.html">
                  metaextract.js
                </a>
              
                
                <a class="source" href="multirun.html">
                  multirun.js
                </a>
              
                
                <a class="source" href="screenshot.html">
                  screenshot.js
                </a>
              
                
                <a class="source" href="statushandlers.html">
                  statushandlers.js
                </a>
              
                
                <a class="source" href="steptimeout.html">
                  steptimeout.js
                </a>
              
                
                <a class="source" href="timeout.html">
                  timeout.js
                </a>
              
                
                <a class="source" href="translate.html">
                  translate.js
                </a>
              
                
                <a class="source" href="syntax.html">
                  syntax.js
                </a>
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
                
                <a class="source" href="hook.html">
                  hook.js
                </a>
              
                
                <a class="source" href="test1.html">
                  test1.js
                </a>
              
                
                <a class="source" href="test2.html">
                  test2.js
                </a>
              
                
                <a class="source" href="test3.html">
                  test3.js
                </a>
              
                
                <a class="source" href="mod.html">
                  mod.js
                </a>
              
                
                <a class="source" href="bar.html">
                  bar.js
                </a>
              
                
                <a class="source" href="baz.html">
                  baz.js
                </a>
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
                
                <a class="source" href="mod.html">
                  mod.js
                </a>
              
                
                <a class="source" href="test.html">
                  test.js
                </a>
              
                
                <a class="source" href="test_coffee.html">
                  test_coffee.js
                </a>
              
                
                <a class="source" href="test_node_json.html">
                  test_node_json.js
                </a>
              
                
                <a class="source" href="test_node_mod.html">
                  test_node_mod.js
                </a>
              
                
                <a class="source" href="test_node_mod_index.html">
                  test_node_mod_index.js
                </a>
              
                
                <a class="source" href="test_node_mod_json_package.html">
                  test_node_mod_json_package.js
                </a>
              
                
                <a class="source" href="test_node_mod.html">
                  test_node_mod.js
                </a>
              
                
                <a class="source" href="test_patched_require.html">
                  test_patched_require.js
                </a>
              
                
                <a class="source" href="options.html">
                  options.js
                </a>
              
                
                <a class="source" href="script.html">
                  script.js
                </a>
              
                
                <a class="source" href="casper-instance-override.html">
                  casper-instance-override.js
                </a>
              
                
                <a class="source" href="dubious.html">
                  dubious.js
                </a>
              
                
                <a class="source" href="exit.html">
                  exit.js
                </a>
              
                
                <a class="source" href="failing.html">
                  failing.js
                </a>
              
                
                <a class="source" href="mytest.html">
                  mytest.js
                </a>
              
                
                <a class="source" href="passing.html">
                  passing.js
                </a>
              
                
                <a class="source" href="skipped.html">
                  skipped.js
                </a>
              
                
                <a class="source" href="step_throws.html">
                  step_throws.js
                </a>
              
                
                <a class="source" href="waitFor_timeout.html">
                  waitFor_timeout.js
                </a>
              
                
                <a class="source" href="run.html">
                  run.js
                </a>
              
                
                <a class="source" href="jsmodule.html">
                  jsmodule.js
                </a>
              
                
                <a class="source" href="selftest.html">
                  selftest.js
                </a>
              
                
                <a class="source" href="dummy.html">
                  dummy.js
                </a>
              
                
                <a class="source" href="include1.html">
                  include1.js
                </a>
              
                
                <a class="source" href="include2.html">
                  include2.js
                </a>
              
                
                <a class="source" href="agent.html">
                  agent.js
                </a>
              
                
                <a class="source" href="alert.html">
                  alert.js
                </a>
              
                
                <a class="source" href="auth.html">
                  auth.js
                </a>
              
                
                <a class="source" href="bypass.html">
                  bypass.js
                </a>
              
                
                <a class="source" href="callback.html">
                  callback.js
                </a>
              
                
                <a class="source" href="callutils.html">
                  callutils.js
                </a>
              
                
                <a class="source" href="capture.html">
                  capture.js
                </a>
              
                
                <a class="source" href="click.html">
                  click.js
                </a>
              
                
                <a class="source" href="confirm.html">
                  confirm.js
                </a>
              
                
                <a class="source" href="content.html">
                  content.js
                </a>
              
                
                <a class="source" href="css3selector.html">
                  css3selector.js
                </a>
              
                
                <a class="source" href="debug.html">
                  debug.js
                </a>
              
                
                <a class="source" href="elementattribute.html">
                  elementattribute.js
                </a>
              
                
                <a class="source" href="encode.html">
                  encode.js
                </a>
              
                
                <a class="source" href="encodedurl.html">
                  encodedurl.js
                </a>
              
                
                <a class="source" href="evaluate.html">
                  evaluate.js
                </a>
              
                
                <a class="source" href="events.html">
                  events.js
                </a>
              
                
                <a class="source" href="exists.html">
                  exists.js
                </a>
              
                
                <a class="source" href="fetchtext.html">
                  fetchtext.js
                </a>
              
                
                <a class="source" href="formfill.html">
                  formfill.js
                </a>
              
                
                <a class="source" href="frames.html">
                  frames.js
                </a>
              
                
                <a class="source" href="getplaintext.html">
                  getplaintext.js
                </a>
              
                
                <a class="source" href="global.html">
                  global.js
                </a>
              
                
                <a class="source" href="headers.html">
                  headers.js
                </a>
              
                
                <a class="source" href="history.html">
                  history.js
                </a>
              
                
                <a class="source" href="hooks.html">
                  hooks.js
                </a>
              
                
                <a class="source" href="keys.html">
                  keys.js
                </a>
              
                
                <a class="source" href="location.html">
                  location.js
                </a>
              
                
                <a class="source" href="logging.html">
                  logging.js
                </a>
              
                
                <a class="source" href="mouseevents.html">
                  mouseevents.js
                </a>
              
                
                <a class="source" href="multiplepopups.html">
                  multiplepopups.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="newpage.html">
                  newpage.js
                </a>
              
                
                <a class="source" href="onerror.html">
                  onerror.js
                </a>
              
                
                <a class="source" href="open.html">
                  open.js
                </a>
              
                
                <a class="source" href="pagerequest.html">
                  pagerequest.js
                </a>
              
                
                <a class="source" href="popup.html">
                  popup.js
                </a>
              
                
                <a class="source" href="prompt.html">
                  prompt.js
                </a>
              
                
                <a class="source" href="reload.html">
                  reload.js
                </a>
              
                
                <a class="source" href="request.html">
                  request.js
                </a>
              
                
                <a class="source" href="resources.html">
                  resources.js
                </a>
              
                
                <a class="source" href="scripts.html">
                  scripts.js
                </a>
              
                
                <a class="source" href="scroll.html">
                  scroll.js
                </a>
              
                
                <a class="source" href="sendAjax.html">
                  sendAjax.js
                </a>
              
                
                <a class="source" href="start.html">
                  start.js
                </a>
              
                
                <a class="source" href="steps.html">
                  steps.js
                </a>
              
                
                <a class="source" href="urls.html">
                  urls.js
                </a>
              
                
                <a class="source" href="viewport.html">
                  viewport.js
                </a>
              
                
                <a class="source" href="visible.html">
                  visible.js
                </a>
              
                
                <a class="source" href="wait.html">
                  wait.js
                </a>
              
                
                <a class="source" href="xpath.html">
                  xpath.js
                </a>
              
                
                <a class="source" href="cli.html">
                  cli.js
                </a>
              
                
                <a class="source" href="clientutils.html">
                  clientutils.js
                </a>
              
                
                <a class="source" href="fs.html">
                  fs.js
                </a>
              
                
                <a class="source" href="http_status.html">
                  http_status.js
                </a>
              
                
                <a class="source" href="pagestack.html">
                  pagestack.js
                </a>
              
                
                <a class="source" href="require.html">
                  require.js
                </a>
              
                
                <a class="source" href="assert.html">
                  assert.js
                </a>
              
                
                <a class="source" href="begin-config.html">
                  begin-config.js
                </a>
              
                
                <a class="source" href="setup-teardown-async.html">
                  setup-teardown-async.js
                </a>
              
                
                <a class="source" href="setup-teardown.html">
                  setup-teardown.js
                </a>
              
                
                <a class="source" href="skip.html">
                  skip.js
                </a>
              
                
                <a class="source" href="test-order.html">
                  test-order.js
                </a>
              
                
                <a class="source" href="testcase.html">
                  testcase.js
                </a>
              
                
                <a class="source" href="testsuite.html">
                  testsuite.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="xunit.html">
                  xunit.js
                </a>
              
                
                <a class="source" href="abc.html">
                  abc.js
                </a>
              
                
                <a class="source" href="def.html">
                  def.js
                </a>
              
                
                <a class="source" href="abc.html">
                  abc.js
                </a>
              
                
                <a class="source" href="03_a.html">
                  03_a.js
                </a>
              
                
                <a class="source" href="03_b.html">
                  03_b.js
                </a>
              
                
                <a class="source" href="01_init.html">
                  01_init.js
                </a>
              
                
                <a class="source" href="02_do.html">
                  02_do.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>tester.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*!
 * Casper is a navigation utility for PhantomJS.
 *
 * Documentation: http://casperjs.org/
 * Repository:    http://github.com/casperjs/casperjs
 *
 * Copyright (c) 2011-2012 Nicolas Perriault
 *
 * Part of source code is Copyright Joyent, Inc. and other Node contributors.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
 * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 *
 */</span>

<span class="hljs-built_in">require</span> = patchRequire(<span class="hljs-built_in">require</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span> events = <span class="hljs-built_in">require</span>(<span class="hljs-string">'events'</span>);
<span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'utils'</span>);
<span class="hljs-keyword">var</span> f = utils.format;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">AssertionError</span>(<span class="hljs-params">msg, result</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-built_in">Error</span>.call(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.message = msg;
    <span class="hljs-keyword">this</span>.name = <span class="hljs-string">'AssertionError'</span>;
    <span class="hljs-keyword">this</span>.result = result;
}
AssertionError.prototype = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>();
exports.AssertionError = AssertionError;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TerminationError</span>(<span class="hljs-params">msg</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-built_in">Error</span>.call(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.message = msg;
    <span class="hljs-keyword">this</span>.name = <span class="hljs-string">'TerminationError'</span>;
}
TerminationError.prototype = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>();
exports.TerminationError = TerminationError;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TimedOutError</span>(<span class="hljs-params">msg</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-built_in">Error</span>.call(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.message = msg;
    <span class="hljs-keyword">this</span>.name = <span class="hljs-string">'TimedOutError'</span>;
}
TimedOutError.prototype = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>();
exports.TimedOutError = TimedOutError;

<span class="hljs-comment">/**
 * Creates a tester instance.
 *
 * @param  Casper  casper   A Casper instance
 * @param  Object  options  Tester options
 * @return Tester
 */</span>
exports.create = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span>(<span class="hljs-params">casper, options</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Tester(casper, options);
};

<span class="hljs-comment">/**
 * Casper tester: makes assertions, stores test results and display then.
 *
 * @param  Casper       casper   A valid Casper instance
 * @param  Object|null  options  Options object
 */</span>
<span class="hljs-keyword">var</span> Tester = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Tester</span>(<span class="hljs-params">casper, options</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-comment">/*eslint max-statements:0*/</span>
    <span class="hljs-keyword">if</span> (!utils.isCasperObject(casper)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CasperError(<span class="hljs-string">"Tester needs a Casper instance"</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>self reference</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>casper reference</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.casper = casper;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>public properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._setUp = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._tearDown = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>.aborted = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.executed = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.currentTestFile = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.currentTestStartTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
    <span class="hljs-keyword">this</span>.currentSuite = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>.currentSuiteNum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.lastAssertTime = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.loadIncludes = {
        <span class="hljs-attr">includes</span>: [],
        <span class="hljs-attr">pre</span>:      [],
        <span class="hljs-attr">post</span>:     []
    };
    <span class="hljs-keyword">this</span>.options = utils.mergeObjects({
        <span class="hljs-attr">concise</span>:  <span class="hljs-literal">false</span>,  <span class="hljs-comment">// concise output?</span>
        failFast: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// terminates a suite as soon as a test fails?</span>
        failText: <span class="hljs-string">"FAIL"</span>, <span class="hljs-comment">// text to use for a failed test</span>
        passText: <span class="hljs-string">"PASS"</span>, <span class="hljs-comment">// text to use for a succesful test</span>
        skipText: <span class="hljs-string">"SKIP"</span>, <span class="hljs-comment">// text to use for a skipped test</span>
        save:     <span class="hljs-literal">false</span>,  <span class="hljs-comment">// false to not save </span>
        pad:      <span class="hljs-number">80</span>    , <span class="hljs-comment">// maximum number of chars for a result line</span>
        warnText: <span class="hljs-string">"WARN"</span>  <span class="hljs-comment">// text to use for a dubious test</span>
    }, options);
    <span class="hljs-keyword">this</span>.queue = [];
    <span class="hljs-keyword">this</span>.running = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.started = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.suiteResults = <span class="hljs-keyword">new</span> TestSuiteResult();

    <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'success'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onSuccess</span>(<span class="hljs-params">success</span>) </span>{
        <span class="hljs-keyword">var</span> timeElapsed = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() - <span class="hljs-keyword">this</span>.currentTestStartTime;
        <span class="hljs-keyword">this</span>.currentSuite.addSuccess(success, timeElapsed - <span class="hljs-keyword">this</span>.lastAssertTime);
        <span class="hljs-keyword">this</span>.lastAssertTime = timeElapsed;
    });

    <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'skipped'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onSkipped</span>(<span class="hljs-params">skipped</span>) </span>{
        <span class="hljs-keyword">var</span> timeElapsed = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() - <span class="hljs-keyword">this</span>.currentTestStartTime;
        <span class="hljs-keyword">this</span>.currentSuite.addSkip(skipped, timeElapsed - <span class="hljs-keyword">this</span>.lastAssertTime);
        <span class="hljs-keyword">this</span>.lastAssertTime = timeElapsed;
    });

    <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFail</span>(<span class="hljs-params">failure</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>export</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> valueKeys = <span class="hljs-built_in">Object</span>.keys(failure.values),
            timeElapsed = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() - <span class="hljs-keyword">this</span>.currentTestStartTime;
        <span class="hljs-keyword">this</span>.currentSuite.addFailure(failure, timeElapsed - <span class="hljs-keyword">this</span>.lastAssertTime);
        <span class="hljs-keyword">this</span>.lastAssertTime = timeElapsed;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>special printing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (failure.type) {
            <span class="hljs-keyword">this</span>.comment(<span class="hljs-string">'   type: '</span> + failure.type);
        }
        <span class="hljs-keyword">if</span> (failure.file) {
            <span class="hljs-keyword">this</span>.comment(<span class="hljs-string">'   file: '</span> + failure.file + (failure.line ? <span class="hljs-string">':'</span> + failure.line : <span class="hljs-string">''</span>));
        }
        <span class="hljs-keyword">if</span> (failure.lineContents) {
            <span class="hljs-keyword">this</span>.comment(<span class="hljs-string">'   code: '</span> + failure.lineContents);
        }
        <span class="hljs-keyword">if</span> (!failure.values || valueKeys.length === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span>;
        }
        valueKeys.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
            <span class="hljs-keyword">this</span>.comment(f(<span class="hljs-string">'   %s: %s'</span>, name, utils.formatTestValue(failure.values[name], name)));
        }.bind(<span class="hljs-keyword">this</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>check for fast failing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.failFast) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.terminate(<span class="hljs-string">'--fail-fast: aborted all remaining tests'</span>);
        }
    });

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errorHandler</span>(<span class="hljs-params">error, backtrace</span>) </span>{
        self.casper.unwait();
        <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>) {
            self.processError(error);
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (utils.isString(error) &amp;&amp; <span class="hljs-regexp">/^(Assertion|Termination|TimedOut)Error/</span>.test(error)) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">var</span> line = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">try</span> {
            line = (backtrace || []).filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">entry</span>) </span>{
                <span class="hljs-keyword">return</span> self.currentTestFile === entry.file;
            })[<span class="hljs-number">0</span>].line;
        } <span class="hljs-keyword">catch</span> (e) {}
        self.uncaughtError(error, self.currentTestFile, line, backtrace);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errorHandlerAndDone</span>(<span class="hljs-params">error, backtrace</span>) </span>{
        errorHandler(error, backtrace);
        self.done();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>casper events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.casper.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCasperError</span>(<span class="hljs-params">msg, backtrace</span>) </span>{
        self.processPhantomError(msg, backtrace);
    });

    [
        <span class="hljs-string">'wait.error'</span>,
        <span class="hljs-string">'waitFor.timeout.error'</span>,
        <span class="hljs-string">'event.error'</span>,
        <span class="hljs-string">'complete.error'</span>
    ].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
        self.casper.on(event, errorHandlerAndDone);
    });

    self.casper.on(<span class="hljs-string">'step.error'</span>, errorHandler);

    <span class="hljs-keyword">this</span>.casper.on(<span class="hljs-string">'warn'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">warning</span>) </span>{
        <span class="hljs-keyword">if</span> (self.currentSuite) {
            self.currentSuite.addWarning(warning);
        }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Do not hook casper if weâ€™re not testing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!phantom.casperTest) {
        <span class="hljs-keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>specific timeout callbacks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.casper.options.onStepTimeout = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test_onStepTimeout</span>(<span class="hljs-params">timeout, step</span>) </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> TimedOutError(f(<span class="hljs-string">"Step timeout occured at step %s (%dms)"</span>, step, timeout));
    };

    <span class="hljs-keyword">this</span>.casper.options.onTimeout = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test_onTimeout</span>(<span class="hljs-params">timeout</span>) </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> TimedOutError(f(<span class="hljs-string">"Timeout occured (%dms)"</span>, timeout));
    };

    <span class="hljs-keyword">this</span>.casper.options.onWaitTimeout = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test_onWaitTimeout</span>(<span class="hljs-params">timeout, details</span>) </span>{
        <span class="hljs-comment">/*eslint complexity:0*/</span>
        <span class="hljs-keyword">var</span> message = f(<span class="hljs-string">"Wait timeout occured (%dms)"</span>, timeout);
        details = details || {};

        <span class="hljs-keyword">if</span> (details.selector) {
            message = f(details.waitWhile ? <span class="hljs-string">'"%s" never went away in %dms'</span> : <span class="hljs-string">'"%s" still did not exist in %dms'</span>, details.selector, timeout);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (details.visible) {
            message = f(details.waitWhile ? <span class="hljs-string">'"%s" never disappeared in %dms'</span> : <span class="hljs-string">'"%s" never appeared in %dms'</span>, details.visible, timeout);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (details.url || details.resource) {
            message = f(<span class="hljs-string">'%s did not load in %dms'</span>, details.url || details.resource, timeout);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (details.popup) {
            message = f(<span class="hljs-string">'%s did not pop up in %dms'</span>, details.popup, timeout);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (details.text) {
            message = f(<span class="hljs-string">'"%s" did not appear in the page in %dms'</span>, details.text, timeout);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (details.selectorTextChange) {
            message = f(<span class="hljs-string">'"%s" did not have a text change in %dms'</span>, details.selectorTextChange, timeout);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (utils.isFunction(details.testFx)) {
            message = f(<span class="hljs-string">'"%s" did not evaluate to something truthy in %dms'</span>, details.testFx.toString(), timeout);
        }

        errorHandlerAndDone(<span class="hljs-keyword">new</span> TimedOutError(message));
    };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Tester class is an EventEmitter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>utils.inherits(Tester, events.EventEmitter);
exports.Tester = Tester;

<span class="hljs-comment">/**
 * Aborts current test suite.
 *
 * @param  String  message Warning message (optional)
 */</span>
Tester.prototype.abort = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">abort</span>(<span class="hljs-params">message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> TerminationError(message || <span class="hljs-string">'test suite aborted'</span>);
};

<span class="hljs-comment">/**
 * Skip `nb` tests.
 *
 * @param  Integer  nb       Number of tests to skip
 * @param  String   message  Message to display
 * @return Object
 */</span>
Tester.prototype.skip = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">skip</span>(<span class="hljs-params">nb, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.processAssertionResult({
        <span class="hljs-attr">success</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">standard</span>: f(<span class="hljs-string">"%d test%s skipped"</span>, nb, nb &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">"s"</span> : <span class="hljs-string">""</span>),
        <span class="hljs-attr">message</span>: message,
        <span class="hljs-attr">type</span>: <span class="hljs-string">"skip"</span>,
        <span class="hljs-attr">number</span>: nb,
        <span class="hljs-attr">skipped</span>: <span class="hljs-literal">true</span>
    });
};

<span class="hljs-comment">/**
 * Skip `nb` test on specific engine(s).
 *
 * A skip specifier is an object of the form:
 * {
 *     name: 'casperjs' | 'phantomjs',
 *     version: {
 *         min:   Object,
 *         max:   Object
 *     },
 *     message: String
 * }
 *
 * Minimal and maximal versions to be skipped are determined using
 * utils.matchEngine.
 *
 * @param  Integer  nb        Number of tests to skip
 * @param  Mixed    skipSpec  a single skip specifier object or
 *                            an Array of skip specifier objects
 * @return Object
 */</span>
Tester.prototype.skipIfEngine = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">skipIfEngine</span>(<span class="hljs-params">nb, skipSpec</span>) </span>{
    skipSpec = utils.matchEngine(skipSpec);
    <span class="hljs-keyword">if</span> (skipSpec) {
        <span class="hljs-keyword">var</span> message = skipSpec.name;
        <span class="hljs-keyword">var</span> version = skipSpec.version;
        <span class="hljs-keyword">var</span> skipMessage = skipSpec.message;
        <span class="hljs-keyword">if</span> (version) {
            <span class="hljs-keyword">var</span> min = version.min;
            <span class="hljs-keyword">var</span> max = version.max;
            <span class="hljs-keyword">if</span> (min &amp;&amp; min === max) {
                message += <span class="hljs-string">' '</span> + min;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (min) {
                    message += <span class="hljs-string">' from '</span> + min;
                }
                <span class="hljs-keyword">if</span> (max) {
                    message += <span class="hljs-string">' to '</span> + max;
                }
            }
        }
        <span class="hljs-keyword">if</span> (skipMessage) {
            message += <span class="hljs-string">' '</span> + skipMessage;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.skip(nb, message);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

<span class="hljs-comment">/**
 * Asserts that a condition strictly resolves to true. Also returns an
 * "assertion object" containing useful informations about the test case
 * results.
 *
 * This method is also used as the base one used for all other `assert*`
 * family methods; supplementary informations are then passed using the
 * `context` argument.
 *
 * Note: an AssertionError is thrown if the assertion fails.
 *
 * @param  Boolean      subject  The condition to test
 * @param  String       message  Test description
 * @param  Object|null  context  Assertion context object (Optional)
 * @return Object                An assertion result object if test passed
 * @throws AssertionError in case the test failed
 */</span>
Tester.prototype.assert =
Tester.prototype.assertTrue = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assert</span>(<span class="hljs-params">subject, message, context</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">this</span>.executed++;
    <span class="hljs-keyword">var</span> result = utils.mergeObjects({
        <span class="hljs-attr">success</span>: subject === <span class="hljs-literal">true</span>,
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assert"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Subject is strictly true"</span>,
        <span class="hljs-attr">message</span>: message,
        <span class="hljs-attr">file</span>: <span class="hljs-keyword">this</span>.currentTestFile,
        <span class="hljs-attr">doThrow</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">subject</span>: utils.getPropertyPath(context, <span class="hljs-string">'values.subject'</span>) || subject
        }
    }, context || {});
    <span class="hljs-keyword">if</span> (!result.success &amp;&amp; result.doThrow) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> AssertionError(message || result.standard, result);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.processAssertionResult(result);
};

<span class="hljs-comment">/**
 * Asserts that two values are strictly equals.
 *
 * @param  Mixed   subject   The value to test
 * @param  Mixed   expected  The expected value
 * @param  String  message   Test description (Optional)
 * @return Object            An assertion result object
 */</span>
Tester.prototype.assertEquals =
Tester.prototype.assertEqual = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertEquals</span>(<span class="hljs-params">subject, expected, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(utils.equals(subject, expected), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertEquals"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Subject equals the expected value"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">subject</span>:  subject,
            <span class="hljs-attr">expected</span>: expected
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that two values are strictly not equals.
 *
 * @param  Mixed        subject   The value to test
 * @param  Mixed        expected  The unwanted value
 * @param  String|null  message   Test description (Optional)
 * @return Object                 An assertion result object
 */</span>
Tester.prototype.assertNotEquals = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertNotEquals</span>(<span class="hljs-params">subject, shouldnt, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(!<span class="hljs-keyword">this</span>.testEquals(subject, shouldnt), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertNotEquals"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Subject doesn't equal what it shouldn't be"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">subject</span>:  subject,
            <span class="hljs-attr">shouldnt</span>: shouldnt
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that a selector expression matches n elements.
 *
 * @param  Mixed   selector  A selector expression
 * @param  Number  count     Expected number of matching elements
 * @param  String  message   Test description (Optional)
 * @return Object            An assertion result object
 */</span>
Tester.prototype.assertElementCount = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertElementCount</span>(<span class="hljs-params">selector, count, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">if</span> (!utils.isNumber(count) || count &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CasperError(<span class="hljs-string">'assertElementCount() needs a positive integer count'</span>);
    }
    <span class="hljs-keyword">var</span> elementCount = <span class="hljs-keyword">this</span>.casper.evaluate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">selector</span>) </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> __utils__.findAll(selector).length;
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
        }
    }, selector);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(elementCount === count, message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertElementCount"</span>,
        <span class="hljs-attr">standard</span>: f(<span class="hljs-string">'%d element%s matching selector "%s" found'</span>,
                    count,
                    count &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">'s'</span> : <span class="hljs-string">''</span>,
                    selector),
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">selector</span>: selector,
            <span class="hljs-attr">expected</span>: count,
            <span class="hljs-attr">obtained</span>: elementCount
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that a code evaluation in remote DOM resolves to true.
 *
 * @param  Function  fn       A function to be evaluated in remote DOM
 * @param  String    message  Test description
 * @param  Object    params   Object/Array containing the parameters to inject into
 *                            the function (optional)
 * @return Object             An assertion result object
 */</span>
Tester.prototype.assertEval =
Tester.prototype.assertEvaluate = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertEval</span>(<span class="hljs-params">fn, message, params</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(<span class="hljs-keyword">this</span>.casper.evaluate(fn, params), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertEval"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Evaluated function returns true"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">fn</span>: fn,
            <span class="hljs-attr">params</span>: params
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that the result of a code evaluation in remote DOM equals
 * an expected value.
 *
 * @param  Function     fn        The function to be evaluated in remote DOM
 * @param  Boolean      expected  The expected value
 * @param  String|null  message   Test description
 * @param  Object|null  params    Object containing the parameters to inject into the
 *                                function (optional)
 * @return Object                 An assertion result object
 */</span>
Tester.prototype.assertEvalEquals =
Tester.prototype.assertEvalEqual = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertEvalEquals</span>(<span class="hljs-params">fn, expected, message, params</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> subject = <span class="hljs-keyword">this</span>.casper.evaluate(fn, params);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(utils.equals(subject, expected), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertEvalEquals"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Evaluated function returns the expected value"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">fn</span>: fn,
            <span class="hljs-attr">params</span>: params,
            <span class="hljs-attr">subject</span>:  subject,
            <span class="hljs-attr">expected</span>: expected
        }
    });
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">baseFieldAssert</span>(<span class="hljs-params">inputName, expected, actual, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(utils.equals(actual, expected),  message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'assertField'</span>,
        <span class="hljs-attr">standard</span>: f(<span class="hljs-string">'"%s" input field has the value "%s"'</span>, inputName, expected),
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">inputName</span>: inputName,
            <span class="hljs-attr">actual</span>: actual,
            <span class="hljs-attr">expected</span>: expected
         }
    });
}

<span class="hljs-comment">/**
 * Asserts that the provided assertion fails (used for internal testing).
 *
 * @param  Function     fn       A closure calling an assertion
 * @param  String|null  message  Test description
 * @return Object                An assertion result object
 */</span>
Tester.prototype.assertFail = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertFail</span>(<span class="hljs-params">fn, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> failed = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">try</span> {
        fn();
    } <span class="hljs-keyword">catch</span> (e) {
        failed = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(failed, message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertFail"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Assertion fails as expected"</span>
    });
};

<span class="hljs-comment">/**
 * Asserts that a given input field has the provided value.
 *
 * @param  String|Object   input      The name attribute of the input element
 *                                    or an object with the selector
 * @param  String          expected   The expected value of the input element
 * @param  String          message    Test description
 * @param  Object          options    ClientUtils#getFieldValue options (optional)
 * @return Object                     An assertion result object
 */</span>
Tester.prototype.assertField = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertField</span>(<span class="hljs-params">input, expected, message, options</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> input === <span class="hljs-string">'object'</span>) {
        <span class="hljs-keyword">switch</span> (input.type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'css'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assertFieldCSS(input.path, expected, message);
            <span class="hljs-keyword">case</span> <span class="hljs-string">'xpath'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assertFieldXPath(input.path, expected, message);
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CasperError(<span class="hljs-string">'Invalid regexp.'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>no default</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
    }

    <span class="hljs-keyword">var</span> actual = <span class="hljs-keyword">this</span>.casper.evaluate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">inputName</span>) </span>{
        <span class="hljs-keyword">return</span> __utils__.getFieldValue(__utils__.makeSelector(inputName,<span class="hljs-string">'name'</span>));
    }, input);

    <span class="hljs-keyword">return</span> baseFieldAssert.call(<span class="hljs-keyword">this</span>, input, expected, actual, message);
};

<span class="hljs-comment">/**
 * Asserts that a given input field by CSS selector has the provided value.
 *
 * @param  Object   cssSelector The CSS selector to use for the assert field value
 * @param  String   expected    The expected value of the input element
 * @param  String   message     Test description
 * @return Object               An assertion result object
 */</span>
Tester.prototype.assertFieldCSS = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertFieldCSS</span>(<span class="hljs-params">cssSelector, expected, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> actual = <span class="hljs-keyword">this</span>.casper.evaluate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">inputName</span>) </span>{
        <span class="hljs-keyword">return</span> __utils__.getFieldValue(__utils__.makeSelector(inputName,<span class="hljs-string">'css'</span>));
    }, cssSelector);

    <span class="hljs-keyword">return</span> baseFieldAssert.call(<span class="hljs-keyword">this</span>, <span class="hljs-literal">null</span>, expected, actual, message);
};

<span class="hljs-comment">/**
 * Asserts that a given input field by XPath selector has the provided value.
 *
 * @param  Object   xPathSelector The XPath selector to use for the assert field value
 * @param  String   expected      The expected value of the input element
 * @param  String   message       Test description
 * @return Object                 An assertion result object
 */</span>
Tester.prototype.assertFieldXPath = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertFieldXPath</span>(<span class="hljs-params">xPathSelector, expected, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> actual = <span class="hljs-keyword">this</span>.casper.evaluate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">inputName</span>) </span>{
        <span class="hljs-keyword">return</span> __utils__.getFieldValue(__utils__.makeSelector(inputName,<span class="hljs-string">'xpath'</span>));
    }, xPathSelector);

    <span class="hljs-keyword">return</span> baseFieldAssert.call(<span class="hljs-keyword">this</span>, <span class="hljs-literal">null</span>, expected, actual, message);
};

<span class="hljs-comment">/**
 * Asserts that an element matching the provided selector expression exists in
 * remote DOM.
 *
 * @param  String   selector  Selector expression
 * @param  String   message   Test description
 * @return Object             An assertion result object
 */</span>
Tester.prototype.assertExists =
Tester.prototype.assertExist =
Tester.prototype.assertSelectorExists =
Tester.prototype.assertSelectorExist = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertExists</span>(<span class="hljs-params">selector, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(<span class="hljs-keyword">this</span>.casper.exists(selector), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertExists"</span>,
        <span class="hljs-attr">standard</span>: f(<span class="hljs-string">"Find an element matching: %s"</span>, selector),
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">selector</span>: selector
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that an element matching the provided selector expression does not
 * exist in remote DOM.
 *
 * @param  String   selector  Selector expression
 * @param  String   message   Test description
 * @return Object             An assertion result object
 */</span>
Tester.prototype.assertDoesntExist =
Tester.prototype.assertNotExists = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertDoesntExist</span>(<span class="hljs-params">selector, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(!<span class="hljs-keyword">this</span>.casper.exists(selector), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertDoesntExist"</span>,
        <span class="hljs-attr">standard</span>: f(<span class="hljs-string">"Fail to find element matching selector: %s"</span>, selector),
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">selector</span>: selector
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that current HTTP status is the one passed as argument.
 *
 * @param  Number  status   HTTP status code
 * @param  String  message  Test description
 * @return Object           An assertion result object
 */</span>
Tester.prototype.assertHttpStatus = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertHttpStatus</span>(<span class="hljs-params">status, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> currentHTTPStatus = <span class="hljs-keyword">this</span>.casper.currentHTTPStatus;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(utils.equals(<span class="hljs-keyword">this</span>.casper.currentHTTPStatus, status), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertHttpStatus"</span>,
        <span class="hljs-attr">standard</span>: f(<span class="hljs-string">"HTTP status code is: %s"</span>, status),
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">current</span>: currentHTTPStatus,
            <span class="hljs-attr">expected</span>: status
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that a provided string matches a provided RegExp pattern.
 *
 * @param  String   subject  The string to test
 * @param  RegExp   pattern  A RegExp object instance
 * @param  String   message  Test description
 * @return Object            An assertion result object
 */</span>
Tester.prototype.assertMatch =
Tester.prototype.assertMatches = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertMatch</span>(<span class="hljs-params">subject, pattern, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">if</span> (utils.betterTypeOf(pattern) !== <span class="hljs-string">"regexp"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CasperError(<span class="hljs-string">'Invalid regexp.'</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(pattern.test(subject), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertMatch"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Subject matches the provided pattern"</span>,
        <span class="hljs-attr">values</span>:  {
            <span class="hljs-attr">subject</span>: subject,
            <span class="hljs-attr">pattern</span>: pattern.toString()
        }
    });
};

<span class="hljs-comment">/**
 * Asserts a condition resolves to false.
 *
 * @param  Boolean  condition  The condition to test
 * @param  String   message    Test description
 * @return Object              An assertion result object
 */</span>
Tester.prototype.assertNot =
Tester.prototype.assertFalse = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertNot</span>(<span class="hljs-params">condition, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(!condition, message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertNot"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Subject is falsy"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">condition</span>: condition
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that a selector expression is not currently visible.
 *
 * @param  String  expected  selector expression
 * @param  String  message   Test description
 * @return Object            An assertion result object
 */</span>
Tester.prototype.assertNotVisible =
Tester.prototype.assertInvisible = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertNotVisible</span>(<span class="hljs-params">selector, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(!<span class="hljs-keyword">this</span>.casper.visible(selector), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertNotVisible"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Selector is not visible"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">selector</span>: selector
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that the provided function called with the given parameters
 * will raise an exception.
 *
 * @param  Function  fn       The function to test
 * @param  Array     args     The arguments to pass to the function
 * @param  String    message  Test description
 * @return Object             An assertion result object
 */</span>
Tester.prototype.assertRaises =
Tester.prototype.assertRaise =
Tester.prototype.assertThrows = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertRaises</span>(<span class="hljs-params">fn, args, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> error, thrown = <span class="hljs-literal">false</span>, context = {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertRaises"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Function raises an error"</span>
    };
    <span class="hljs-keyword">try</span> {
        fn.apply(<span class="hljs-literal">null</span>, args);
    } <span class="hljs-keyword">catch</span> (err) {
        thrown = <span class="hljs-literal">true</span>;
        error = err;
    }
    <span class="hljs-keyword">this</span>.assert(thrown, message, utils.mergeObjects(context, {
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">error</span>: error
        }
    }));
};

<span class="hljs-comment">/**
 * Asserts that the current page has a resource that matches the provided test
 *
 * @param  Function/String  test     A test function that is called with every response
 * @param  String           message  Test description
 * @return Object                    An assertion result object
 */</span>
Tester.prototype.assertResourceExists =
Tester.prototype.assertResourceExist = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertResourceExists</span>(<span class="hljs-params">test, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(<span class="hljs-keyword">this</span>.casper.resourceExists(test), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertResourceExists"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Confirm page has resource"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">test</span>: test
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that given text doesn't exist in the document body.
 *
 * @param  String  text     Text not to be found
 * @param  String  message  Test description
 * @return Object           An assertion result object
 */</span>
Tester.prototype.assertTextDoesntExist =
Tester.prototype.assertTextDoesntExist = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertTextDoesntExist</span>(<span class="hljs-params">text, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> textFound = (<span class="hljs-keyword">this</span>.casper.evaluate(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_evaluate</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>.body.textContent || <span class="hljs-built_in">document</span>.body.innerText;
    }).indexOf(text) === <span class="hljs-number">-1</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(textFound, message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertTextDoesntExists"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Text doesn't exist within the document body"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">text</span>: text
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that given text exists in the document body.
 *
 * @param  String  text     Text to be found
 * @param  String  message  Test description
 * @return Object           An assertion result object
 */</span>
Tester.prototype.assertTextExists =
Tester.prototype.assertTextExist = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertTextExists</span>(<span class="hljs-params">text, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> textFound = (<span class="hljs-keyword">this</span>.casper.evaluate(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_evaluate</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>.body.textContent || <span class="hljs-built_in">document</span>.body.innerText;
    }).indexOf(text) !== <span class="hljs-number">-1</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(textFound, message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertTextExists"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Find text within the document body"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">text</span>: text
        }
    });
};

<span class="hljs-comment">/**
 * Asserts a subject is truthy.
 *
 * @param  Mixed   subject  Test subject
 * @param  String  message  Test description
 * @return Object           An assertion result object
 */</span>
Tester.prototype.assertTruthy = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertTruthy</span>(<span class="hljs-params">subject, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-comment">/*eslint eqeqeq:0*/</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(utils.isTruthy(subject), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertTruthy"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Subject is truthy"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">subject</span>: subject
        }
    });
};

<span class="hljs-comment">/**
 * Asserts a subject is falsy.
 *
 * @param  Mixed   subject  Test subject
 * @param  String  message  Test description
 * @return Object           An assertion result object
 */</span>
Tester.prototype.assertFalsy = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertFalsy</span>(<span class="hljs-params">subject, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-comment">/*eslint eqeqeq:0*/</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(utils.isFalsy(subject), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertFalsy"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Subject is falsy"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">subject</span>: subject
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that given text exists in the provided selector.
 *
 * @param  String   selector  Selector expression
 * @param  String   text      Text to be found
 * @param  String   message   Test description
 * @return Object             An assertion result object
 */</span>
Tester.prototype.assertSelectorHasText =
Tester.prototype.assertSelectorContains = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertSelectorHasText</span>(<span class="hljs-params">selector, text, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> got = <span class="hljs-keyword">this</span>.casper.fetchText(selector);
    <span class="hljs-keyword">var</span> textFound = got.indexOf(text) !== <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(textFound, message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertSelectorHasText"</span>,
        <span class="hljs-attr">standard</span>: f(<span class="hljs-string">'Find "%s" within the selector "%s"'</span>, text, selector),
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">selector</span>: selector,
            <span class="hljs-attr">text</span>: text,
            <span class="hljs-attr">actualContent</span>: got
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that given text does not exist in the provided selector.
 *
 * @param  String   selector  Selector expression
 * @param  String   text      Text not to be found
 * @param  String   message   Test description
 * @return Object             An assertion result object
 */</span>
Tester.prototype.assertSelectorDoesntHaveText =
Tester.prototype.assertSelectorDoesntContain = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertSelectorDoesntHaveText</span>(<span class="hljs-params">selector, text, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> textFound = <span class="hljs-keyword">this</span>.casper.fetchText(selector).indexOf(text) === <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(textFound, message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertSelectorDoesntHaveText"</span>,
        <span class="hljs-attr">standard</span>: f(<span class="hljs-string">'Did not find "%s" within the selector "%s"'</span>, text, selector),
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">selector</span>: selector,
            <span class="hljs-attr">text</span>: text
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that title of the remote page equals to the expected one.
 *
 * @param  String  expected  The expected title string
 * @param  String  message   Test description
 * @return Object            An assertion result object
 */</span>
Tester.prototype.assertTitle = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertTitle</span>(<span class="hljs-params">expected, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> currentTitle = <span class="hljs-keyword">this</span>.casper.getTitle();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(utils.equals(currentTitle, expected), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertTitle"</span>,
        <span class="hljs-attr">standard</span>: f(<span class="hljs-string">'Page title is: "%s"'</span>, expected),
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">subject</span>: currentTitle,
            <span class="hljs-attr">expected</span>: expected
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that title of the remote page matched the provided pattern.
 *
 * @param  RegExp  pattern  The pattern to test the title against
 * @param  String  message  Test description
 * @return Object           An assertion result object
 */</span>
Tester.prototype.assertTitleMatch =
Tester.prototype.assertTitleMatches = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertTitleMatch</span>(<span class="hljs-params">pattern, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">if</span> (utils.betterTypeOf(pattern) !== <span class="hljs-string">"regexp"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CasperError(<span class="hljs-string">'Invalid regexp.'</span>);
    }
    <span class="hljs-keyword">var</span> currentTitle = <span class="hljs-keyword">this</span>.casper.getTitle();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(pattern.test(currentTitle), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertTitle"</span>,
        <span class="hljs-attr">details</span>: <span class="hljs-string">"Page title does not match the provided pattern"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">subject</span>: currentTitle,
            <span class="hljs-attr">pattern</span>: pattern.toString()
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that the provided subject is of the given type.
 *
 * @param  mixed   subject  The value to test
 * @param  String  type     The javascript type name
 * @param  String  message  Test description
 * @return Object           An assertion result object
 */</span>
Tester.prototype.assertType = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertType</span>(<span class="hljs-params">subject, type, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> actual = utils.betterTypeOf(subject);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(utils.equals(actual, type), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertType"</span>,
        <span class="hljs-attr">standard</span>: f(<span class="hljs-string">'Subject type is: "%s"'</span>, type),
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">subject</span>: subject,
            <span class="hljs-attr">type</span>: type,
            <span class="hljs-attr">actual</span>: actual
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that the provided subject has the provided constructor in its prototype hierarchy.
 *
 * @param  mixed   subject       The value to test
 * @param  Function constructor  The javascript type name
 * @param  String  message       Test description
 * @return Object                An assertion result object
 */</span>
Tester.prototype.assertInstanceOf = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertInstanceOf</span>(<span class="hljs-params">subject, constructor, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">if</span> (utils.betterTypeOf(<span class="hljs-keyword">constructor</span>) !== "function") {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CasperError(<span class="hljs-string">'Subject is null or undefined.'</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(utils.betterInstanceOf(subject, <span class="hljs-keyword">constructor</span>), message, {
        type: <span class="hljs-string">"assertInstanceOf"</span>,
        <span class="hljs-attr">standard</span>: f(<span class="hljs-string">'Subject is instance of: "%s"'</span>, <span class="hljs-keyword">constructor</span>.name),
        values: {
            subject: subject,
            <span class="hljs-attr">constructorName</span>: <span class="hljs-keyword">constructor</span>.name
        }
    });
};

/**
 * Asserts that a the current page url matches a given pattern. A pattern may be
 * either a RegExp object or a String. The method will test if the URL matches
 * the pattern or contains the String.
 *
 * @param  RegExp|String  pattern  The test pattern
 * @param  String         message  Test description
 * @return Object                  An assertion result object
 */
Tester.prototype.assertUrlMatch =
Tester.prototype.assertUrlMatches = function assertUrlMatch(pattern, message) {
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> currentUrl = <span class="hljs-keyword">this</span>.casper.getCurrentUrl(),
        patternType = utils.betterTypeOf(pattern),
        result;
    <span class="hljs-keyword">if</span> (patternType === <span class="hljs-string">"regexp"</span>) {
        result = pattern.test(currentUrl);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (patternType === <span class="hljs-string">"string"</span>) {
        result = currentUrl.indexOf(pattern) !== <span class="hljs-number">-1</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CasperError(<span class="hljs-string">"assertUrlMatch() only accepts strings or regexps"</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(result, message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertUrlMatch"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Current url matches the provided pattern"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">currentUrl</span>: currentUrl,
            <span class="hljs-attr">pattern</span>: pattern.toString()
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that a selector expression is currently visible.
 *
 * @param  String  expected  selector expression
 * @param  String  message   Test description
 * @return Object            An assertion result object
 */</span>
Tester.prototype.assertVisible = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertVisible</span>(<span class="hljs-params">selector, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(<span class="hljs-keyword">this</span>.casper.visible(selector), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertVisible"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"Selector is visible"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">selector</span>: selector
        }
    });
};

<span class="hljs-comment">/**
 * Asserts that all elements matching selector expression are currently visible.
 * Fails if even one element is not visible.
 *
 * @param  String  expected  selector expression
 * @param  String  message   Test description
 * @return Object            An assertion result object
 */</span>
Tester.prototype.assertAllVisible = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertAllVisible</span>(<span class="hljs-params">selector, message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(<span class="hljs-keyword">this</span>.casper.allVisible(selector), message, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"assertAllVisible"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"All elements matching selector are visible"</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">selector</span>: selector
        }
    });
};

<span class="hljs-comment">/**
 * Prints out a colored bar onto the console.
 *
 */</span>
Tester.prototype.bar = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bar</span>(<span class="hljs-params">text, style</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">this</span>.casper.echo(text, style, <span class="hljs-keyword">this</span>.options.pad);
};

<span class="hljs-comment">/**
 * Defines a function which will be executed before every test.
 *
 * @param  Function  fn
 */</span>
Tester.prototype.setUp = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setUp</span>(<span class="hljs-params">fn</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">this</span>._setUp = fn;
};

<span class="hljs-comment">/**
 * Defines a function which will be executed after every test.
 *
 * @param  Function  fn
 */</span>
Tester.prototype.tearDown = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tearDown</span>(<span class="hljs-params">fn</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">this</span>._tearDown = fn;
};

<span class="hljs-comment">/**
 * Starts a suite.
 *
 * Can be invoked different ways:
 *
 *     casper.test.begin("suite description", plannedTests, function(test){})
 *     casper.test.begin("suite description", function(test){})
 */</span>
Tester.prototype.begin = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">begin</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.started &amp;&amp; <span class="hljs-keyword">this</span>.running)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.queue.push(<span class="hljs-built_in">arguments</span>);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getConfig</span>(<span class="hljs-params">args</span>) </span>{
        <span class="hljs-keyword">var</span> config = {
            <span class="hljs-attr">setUp</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{},
            <span class="hljs-attr">tearDown</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{}
        };

        <span class="hljs-keyword">if</span> (utils.isFunction(args[<span class="hljs-number">1</span>])) {
            config.test = args[<span class="hljs-number">1</span>];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (utils.isObject(args[<span class="hljs-number">1</span>])) {
            config = utils.mergeObjects(config, args[<span class="hljs-number">1</span>]);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (utils.isNumber(args[<span class="hljs-number">1</span>]) &amp;&amp; utils.isFunction(args[<span class="hljs-number">2</span>])) {
            config.planned = ~~args[<span class="hljs-number">1</span>] || <span class="hljs-literal">undefined</span>;
            config.test = args[<span class="hljs-number">2</span>];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (utils.isNumber(args[<span class="hljs-number">1</span>]) &amp;&amp; utils.isObject(args[<span class="hljs-number">2</span>])) {
            config.config = utils.mergeObjects(config, args[<span class="hljs-number">2</span>]);
            config.planned = ~~args[<span class="hljs-number">1</span>] || <span class="hljs-literal">undefined</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CasperError(<span class="hljs-string">'Invalid call'</span>);
        }

        <span class="hljs-keyword">if</span> (!utils.isFunction(config.test))
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CasperError(<span class="hljs-string">'begin() is missing a mandatory test function'</span>);

        <span class="hljs-keyword">return</span> config;
    }

    <span class="hljs-keyword">var</span> description = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] || f(<span class="hljs-string">"Untitled suite in %s"</span>, <span class="hljs-keyword">this</span>.currentTestFile),
        config = getConfig([].slice.call(<span class="hljs-built_in">arguments</span>)),
        next = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            config.test(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.casper);
        }.bind(<span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.options.concise)
        <span class="hljs-keyword">this</span>.comment(description);

    <span class="hljs-keyword">this</span>.currentSuite = <span class="hljs-keyword">new</span> TestCaseResult({
        <span class="hljs-attr">name</span>: description,
        <span class="hljs-attr">file</span>: <span class="hljs-keyword">this</span>.currentTestFile,
        <span class="hljs-attr">config</span>: config,
        <span class="hljs-attr">planned</span>: config.planned || <span class="hljs-literal">undefined</span>
    });

    <span class="hljs-keyword">this</span>.executed = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.running = <span class="hljs-keyword">this</span>.started = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (config.setUp)
            config.setUp(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.casper);

        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._setUp)
            <span class="hljs-keyword">return</span> next();

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._setUp.length &gt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._setUp.call(<span class="hljs-keyword">this</span>, next); <span class="hljs-comment">// async</span>

        <span class="hljs-keyword">this</span>._setUp.call(<span class="hljs-keyword">this</span>);                  <span class="hljs-comment">// sync</span>
        next();
    } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-keyword">this</span>.processError(err);
        <span class="hljs-keyword">this</span>.done();
    }
};

<span class="hljs-comment">/**
 * Render a colorized output. Basically a proxy method for
 * `Casper.Colorizer#colorize()`.
 *
 * @param  String  message
 * @param  String  style    The style name
 * @return String
 */</span>
Tester.prototype.colorize = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">colorize</span>(<span class="hljs-params">message, style</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.casper.getColorizer().colorize(message, style);
};

<span class="hljs-comment">/**
 * Writes a comment-style formatted message to stdout.
 *
 * @param  String  message
 */</span>
Tester.prototype.comment = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">comment</span>(<span class="hljs-params">message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">this</span>.casper.echo(<span class="hljs-string">'# '</span> + message, <span class="hljs-string">'COMMENT'</span>);
};

<span class="hljs-comment">/**
 * Declares the current test suite done.
 *
 */</span>
Tester.prototype.done = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">done</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-comment">/*eslint max-statements:0, complexity:0*/</span>
    <span class="hljs-keyword">var</span> planned, config = <span class="hljs-keyword">this</span>.currentSuite &amp;&amp; <span class="hljs-keyword">this</span>.currentSuite.config || {};

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &amp;&amp; utils.isNumber(<span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>])) {
        <span class="hljs-keyword">this</span>.casper.warn(<span class="hljs-string">'done() `planned` arg is deprecated as of 1.1'</span>);
        planned = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
    }

    <span class="hljs-keyword">if</span> (config &amp;&amp; config.tearDown &amp;&amp; utils.isFunction(config.tearDown)) {
        <span class="hljs-keyword">try</span> {
            config.tearDown(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.casper);
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-keyword">this</span>.processError(error);
        }
    }

    <span class="hljs-keyword">var</span> next = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentSuite &amp;&amp; <span class="hljs-keyword">this</span>.currentSuite.planned &amp;&amp;
            <span class="hljs-keyword">this</span>.currentSuite.planned !== <span class="hljs-keyword">this</span>.executed + <span class="hljs-keyword">this</span>.currentSuite.skipped &amp;&amp;
            !<span class="hljs-keyword">this</span>.currentSuite.failed) {
            <span class="hljs-keyword">this</span>.dubious(<span class="hljs-keyword">this</span>.currentSuite.planned, <span class="hljs-keyword">this</span>.executed, <span class="hljs-keyword">this</span>.currentSuite.name);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (planned &amp;&amp; planned !== <span class="hljs-keyword">this</span>.executed) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>BC</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">this</span>.dubious(planned, <span class="hljs-keyword">this</span>.executed);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentSuite) {
            <span class="hljs-keyword">this</span>.suiteResults.push(<span class="hljs-keyword">this</span>.currentSuite);
            
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.options.concise) {
                <span class="hljs-keyword">var</span> message = [
                    <span class="hljs-keyword">this</span>.colorize(<span class="hljs-string">'PASS'</span>, <span class="hljs-string">'INFO'</span>),
                    <span class="hljs-keyword">this</span>.formatMessage(<span class="hljs-keyword">this</span>.currentSuite.name)
                ];

                <span class="hljs-keyword">if</span> (config.planned) {
                    message.push([
                        <span class="hljs-keyword">this</span>.colorize(f(<span class="hljs-string">'(%d test%s)'</span>,
                        config.planned,
                        config.planned &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">'s'</span> : <span class="hljs-string">''</span>), <span class="hljs-string">'INFO'</span>)
                    ]);
                }

                <span class="hljs-keyword">this</span>.casper.echo(message.join(<span class="hljs-string">' '</span>));
            }
            
            <span class="hljs-keyword">this</span>.currentSuite = <span class="hljs-literal">undefined</span>;
            <span class="hljs-keyword">this</span>.executed = <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'test.done'</span>);
        <span class="hljs-keyword">this</span>.casper.currentHTTPResponse = {};
        <span class="hljs-keyword">this</span>.running = <span class="hljs-keyword">this</span>.started = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> nextTest = <span class="hljs-keyword">this</span>.queue.shift();
        <span class="hljs-keyword">if</span> (nextTest) {
            <span class="hljs-keyword">this</span>.begin.apply(<span class="hljs-keyword">this</span>, nextTest);
        }
    }.bind(<span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._tearDown) {
        <span class="hljs-keyword">return</span> next();
    }

    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._tearDown.length &gt; <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>async</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">this</span>._tearDown.call(<span class="hljs-keyword">this</span>, next);
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>sync</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">this</span>._tearDown.call(<span class="hljs-keyword">this</span>);
            next();
        }
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-keyword">this</span>.processError(error);
    }
};

<span class="hljs-comment">/**
 * Marks a test as dubious, when the number of planned tests doesn't match the
 * number of actually executed one.
 *
 * @param  String  message
 */</span>
Tester.prototype.dubious = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dubious</span>(<span class="hljs-params">planned, executed, suite</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> message = f(<span class="hljs-string">'%s: %d tests planned, %d tests executed'</span>, suite || <span class="hljs-string">'global'</span>, planned, executed);
    <span class="hljs-keyword">this</span>.casper.warn(message);
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.currentSuite) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>.currentSuite.addFailure({
        <span class="hljs-attr">type</span>:     <span class="hljs-string">"dubious"</span>,
        <span class="hljs-attr">file</span>:     <span class="hljs-keyword">this</span>.currentTestFile,
        <span class="hljs-attr">standard</span>: message
    });
};

<span class="hljs-comment">/**
 * Writes an error-style formatted message to stdout.
 *
 * @param  String  message
 */</span>
Tester.prototype.error = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error</span>(<span class="hljs-params">message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">this</span>.casper.echo(message, <span class="hljs-string">'ERROR'</span>);
};

<span class="hljs-comment">/**
 * Executes a file, wraping and evaluating its code in an isolated
 * environment where only the current `casper` instance is passed.
 *
 * @param  String  file  Absolute path to some js/coffee file
 */</span>
Tester.prototype.exec = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exec</span>(<span class="hljs-params">file</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    file = <span class="hljs-keyword">this</span>.filter(<span class="hljs-string">'exec.file'</span>, file) || file;
    <span class="hljs-keyword">if</span> (!fs.isFile(file) || !utils.isJsFile(file)) {
        <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">new</span> CasperError(f(<span class="hljs-string">"Cannot exec %s: can only exec() files with .js or .coffee extensions"</span>,
                                  file));
        e.fileName = e.file = e.sourceURL = file;
        <span class="hljs-keyword">throw</span> e;
    }
    <span class="hljs-keyword">this</span>.currentTestFile = file;
    phantom.injectJs(file);
};

<span class="hljs-comment">/**
 * Adds a failed test entry to the stack.
 *
 * @param  String  message
 * @param  Object  Failure context (optional)
 */</span>
Tester.prototype.fail = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fail</span>(<span class="hljs-params">message, context</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    context = context || {};
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(<span class="hljs-literal">false</span>, message, utils.mergeObjects({
        <span class="hljs-attr">type</span>:    <span class="hljs-string">"fail"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"explicit call to fail()"</span>
    }, context));
};

<span class="hljs-comment">/**
 * Recursively finds all test files contained in a given directory.
 *
 * @param  String  dir  Path to some directory to scan
 */</span>
Tester.prototype.findTestFiles = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findTestFiles</span>(<span class="hljs-params">dir</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">if</span> (!fs.isDirectory(dir)) {
        <span class="hljs-keyword">return</span> [];
    }
    <span class="hljs-keyword">var</span> entries = fs.list(dir).filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_filter</span>(<span class="hljs-params">entry</span>) </span>{
        <span class="hljs-keyword">return</span> entry !== <span class="hljs-string">'.'</span> &amp;&amp; entry !== <span class="hljs-string">'..'</span>;
    }).map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_map</span>(<span class="hljs-params">entry</span>) </span>{
        <span class="hljs-keyword">return</span> fs.absolute(fs.pathJoin(dir, entry));
    });
    entries.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_forEach</span>(<span class="hljs-params">entry</span>) </span>{
        <span class="hljs-keyword">if</span> (fs.isDirectory(entry)) {
            entries = entries.concat(self.findTestFiles(entry));
        }
    });
    <span class="hljs-keyword">return</span> entries.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_filter</span>(<span class="hljs-params">entry</span>) </span>{
        <span class="hljs-keyword">return</span> utils.isJsFile(entry);
    }).sort();
};

<span class="hljs-comment">/**
 * Computes current suite identifier.
 *
 * @return String
 */</span>
Tester.prototype.getCurrentSuiteId = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentSuiteId</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.casper.test.currentSuiteNum + <span class="hljs-string">"-"</span> + <span class="hljs-keyword">this</span>.casper.step;
};

<span class="hljs-comment">/**
 * Formats a message to highlight some parts of it.
 *
 * @param  String  message
 * @param  String  style
 */</span>
Tester.prototype.formatMessage = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatMessage</span>(<span class="hljs-params">message, style</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> parts = <span class="hljs-regexp">/^([a-z0-9_\.]+\(\))(.*)/i</span>.exec(message);
    <span class="hljs-keyword">if</span> (!parts) {
        <span class="hljs-keyword">return</span> message;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.colorize(parts[<span class="hljs-number">1</span>], <span class="hljs-string">'PARAMETER'</span>) + <span class="hljs-keyword">this</span>.colorize(parts[<span class="hljs-number">2</span>], style);
};

<span class="hljs-comment">/**
 * Writes an info-style formatted message to stdout.
 *
 * @param  String  message
 */</span>
Tester.prototype.info = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">info</span>(<span class="hljs-params">message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">this</span>.casper.echo(message, <span class="hljs-string">'PARAMETER'</span>);
};

<span class="hljs-comment">/**
 * Adds a succesful test entry to the stack.
 *
 * @param  String  message
 */</span>
Tester.prototype.pass = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pass</span>(<span class="hljs-params">message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assert(<span class="hljs-literal">true</span>, message, {
        <span class="hljs-attr">type</span>:    <span class="hljs-string">"pass"</span>,
        <span class="hljs-attr">standard</span>: <span class="hljs-string">"explicit call to pass()"</span>
    });
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStackEntry</span>(<span class="hljs-params">error, testFile</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"stackArray"</span> <span class="hljs-keyword">in</span> error) {</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>PhantomJS has changed the API of the Error object :-/
<a href="https://github.com/ariya/phantomjs/commit/c9cf14f221f58a3daf585c47313da6fced0276bc">https://github.com/ariya/phantomjs/commit/c9cf14f221f58a3daf585c47313da6fced0276bc</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> error.stackArray.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">entry</span>) </span>{
            <span class="hljs-keyword">return</span> testFile === entry.sourceURL;
        })[<span class="hljs-number">0</span>];
    }

    <span class="hljs-keyword">if</span> (! (<span class="hljs-string">'stack'</span> <span class="hljs-keyword">in</span> error))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">var</span> r = <span class="hljs-regexp">/\r?\n\s*(.*?)(at |@)([^:]*?):(\d+):?(\d*)/g</span>;
    <span class="hljs-keyword">var</span> m;
    <span class="hljs-keyword">while</span> ((m = r.exec(error.stack))) {
        <span class="hljs-keyword">var</span> sourceURL = m[<span class="hljs-number">3</span>];
        <span class="hljs-keyword">if</span> (sourceURL.indexOf(<span class="hljs-string">'-&gt;'</span>) !== <span class="hljs-number">-1</span>) {
            sourceURL = sourceURL.split(<span class="hljs-string">'-&gt;'</span>)[<span class="hljs-number">1</span>].trim();
        }
        <span class="hljs-keyword">if</span> (sourceURL === testFile) {
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">sourceURL</span>: sourceURL, <span class="hljs-attr">line</span>: m[<span class="hljs-number">4</span>], <span class="hljs-attr">column</span>: m[<span class="hljs-number">5</span>]};
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">/**
 * Processes an assertion error.
 *
 * @param  AssertionError  error
 */</span>
Tester.prototype.processAssertionError = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> result = error &amp;&amp; error.result || {},
        testFile = <span class="hljs-keyword">this</span>.currentTestFile,
        stackEntry;
    <span class="hljs-keyword">try</span> {
        stackEntry = getStackEntry(error, testFile);
    } <span class="hljs-keyword">catch</span> (e) {}
    <span class="hljs-keyword">if</span> (stackEntry) {
        result.line = stackEntry.line;
        <span class="hljs-keyword">try</span> {
            result.lineContents = fs.read(<span class="hljs-keyword">this</span>.currentTestFile).split(<span class="hljs-string">'\n'</span>)[result.line - <span class="hljs-number">1</span>].trim();
        } <span class="hljs-keyword">catch</span> (e) {}
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.processAssertionResult(result);
};

<span class="hljs-comment">/**
 * Processes an assertion result by emitting the appropriate event and
 * printing result onto the console.
 *
 * @param  Object  result  An assertion result object
 * @return Object          The passed assertion result Object
 */</span>
Tester.prototype.processAssertionResult = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processAssertionResult</span>(<span class="hljs-params">result</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.currentSuite) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>this is for BC when begin() didnâ€™t exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.currentSuite = <span class="hljs-keyword">new</span> TestCaseResult({
            <span class="hljs-attr">name</span>: <span class="hljs-string">"Untitled suite in "</span> + <span class="hljs-keyword">this</span>.currentTestFile,
            <span class="hljs-attr">file</span>: <span class="hljs-keyword">this</span>.currentTestFile,
            <span class="hljs-attr">planned</span>: <span class="hljs-literal">undefined</span>
        });
    }
    <span class="hljs-keyword">var</span> eventName = <span class="hljs-string">'success'</span>,
        message = result.message || result.standard,
        style = <span class="hljs-string">'INFO'</span>,
        status = <span class="hljs-keyword">this</span>.options.passText;
    <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> === result.success) {
        eventName = <span class="hljs-string">'skipped'</span>;
        style = <span class="hljs-string">'SKIP'</span>;
        status = <span class="hljs-keyword">this</span>.options.skipText;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!result.success) {
        eventName = <span class="hljs-string">'fail'</span>;
        style = <span class="hljs-string">'RED_BAR'</span>;
        status = <span class="hljs-keyword">this</span>.options.failText;
    }
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.options.concise) {
        <span class="hljs-keyword">this</span>.casper.echo([<span class="hljs-keyword">this</span>.colorize(status, style), <span class="hljs-keyword">this</span>.formatMessage(message)].join(<span class="hljs-string">' '</span>));
    }
    <span class="hljs-keyword">this</span>.emit(eventName, result);
    <span class="hljs-keyword">return</span> result;
};

<span class="hljs-comment">/**
 * Processes an error.
 *
 * @param  Error  error
 */</span>
Tester.prototype.processError = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processError</span>(<span class="hljs-params">error</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> AssertionError) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.processAssertionError(error);
    }
    <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> TerminationError) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.terminate(error.message);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.uncaughtError(error, <span class="hljs-keyword">this</span>.currentTestFile, error.line);
};

<span class="hljs-comment">/**
 * Processes a PhantomJS error, which is an error message and a backtrace.
 *
 * @param  String  message
 * @param  Array   backtrace
 */</span>
Tester.prototype.processPhantomError = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processPhantomError</span>(<span class="hljs-params">msg, backtrace</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^AssertionError/</span>.test(msg)) {
        <span class="hljs-keyword">this</span>.casper.warn(<span class="hljs-string">'looks like you did not use begin(), which is mandatory since 1.1'</span>);
    }
    <span class="hljs-keyword">var</span> termination = <span class="hljs-regexp">/^TerminationError:?\s?(.*)/</span>.exec(msg);
    <span class="hljs-keyword">if</span> (termination) {
        <span class="hljs-keyword">var</span> message = termination[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">if</span> (backtrace &amp;&amp; backtrace[<span class="hljs-number">0</span>]) {
            message += <span class="hljs-string">' at '</span> + backtrace[<span class="hljs-number">0</span>].file + backtrace[<span class="hljs-number">0</span>].line;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.terminate(message);
    }
    <span class="hljs-keyword">this</span>.fail(msg, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"error"</span>,
        <span class="hljs-attr">doThrow</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">error</span>: msg,
            <span class="hljs-attr">stack</span>: backtrace
        }
    });
    <span class="hljs-keyword">this</span>.done();
};

<span class="hljs-comment">/**
 * Renders a detailed report for each failed test.
 *
 */</span>
Tester.prototype.renderFailureDetails = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderFailureDetails</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.suiteResults.isFailed()) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">var</span> failures = <span class="hljs-keyword">this</span>.suiteResults.getAllFailures();
    <span class="hljs-keyword">this</span>.casper.echo(f(<span class="hljs-string">"\nDetails for the %d failed test%s:\n"</span>,
                       failures.length, failures.length &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">"s"</span> : <span class="hljs-string">""</span>), <span class="hljs-string">"PARAMETER"</span>);
    failures.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_forEach</span>(<span class="hljs-params">failure</span>) </span>{
        <span class="hljs-keyword">this</span>.casper.echo(f(<span class="hljs-string">'In %s%s'</span>, failure.file, ~~failure.line ? <span class="hljs-string">':'</span> + ~~failure.line : <span class="hljs-string">''</span>));
        <span class="hljs-keyword">if</span> (failure.suite) {
            <span class="hljs-keyword">this</span>.casper.echo(f(<span class="hljs-string">'  %s'</span>, failure.suite), <span class="hljs-string">"PARAMETER"</span>);
        }
        <span class="hljs-keyword">this</span>.casper.echo(f(<span class="hljs-string">'    %s: %s'</span>, failure.type || <span class="hljs-string">"unknown"</span>,
            failure.message || failure.standard || <span class="hljs-string">"(no message was entered)"</span>), <span class="hljs-string">"COMMENT"</span>);
    }.bind(<span class="hljs-keyword">this</span>));
};

<span class="hljs-comment">/**
 * Render tests results, an optionally exit phantomjs.
 *
 * @param  Boolean  exit    Exit casper after results have been rendered?
 * @param  Number   status  Exit status code (default: 0)
 * @param  String   save    Optional path to file where to save the results log
 */</span>
Tester.prototype.renderResults = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderResults</span>(<span class="hljs-params">exit, status, save</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-comment">/*eslint max-statements:0*/</span>
    save = save || <span class="hljs-keyword">this</span>.options.save;
    <span class="hljs-keyword">var</span> exitStatus = <span class="hljs-number">0</span>,
        failed = <span class="hljs-keyword">this</span>.suiteResults.countFailed(),
        total = <span class="hljs-keyword">this</span>.suiteResults.countExecuted(),
        statusText,
        style,
        result;
    <span class="hljs-keyword">if</span> (total === <span class="hljs-number">0</span>) {
        exitStatus = <span class="hljs-number">1</span>;
        statusText = <span class="hljs-keyword">this</span>.options.warnText;
        style = <span class="hljs-string">'WARN_BAR'</span>;
        result = f(<span class="hljs-string">"%s Looks like you didn't run any tests."</span>, statusText);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.suiteResults.isFailed()) {
            exitStatus = <span class="hljs-number">1</span>;
            statusText = <span class="hljs-keyword">this</span>.options.failText;
            style = <span class="hljs-string">'RED_BAR'</span>;
        } <span class="hljs-keyword">else</span> {
            statusText = <span class="hljs-keyword">this</span>.options.passText;
            style = <span class="hljs-string">'GREEN_BAR'</span>;
        }
        result = f(<span class="hljs-string">'%s %d test%s executed in %ss, %d passed, %d failed, %d dubious, %d skipped.'</span>,
                   statusText,
                   total,
                   total &gt; <span class="hljs-number">1</span> ? <span class="hljs-string">"s"</span> : <span class="hljs-string">""</span>,
                   utils.ms2seconds(<span class="hljs-keyword">this</span>.suiteResults.calculateDuration()),
                   <span class="hljs-keyword">this</span>.suiteResults.countPassed(),
                   failed,
                   <span class="hljs-keyword">this</span>.suiteResults.countDubious(),
                   <span class="hljs-keyword">this</span>.suiteResults.countSkipped());
    }
    <span class="hljs-keyword">this</span>.casper.echo(result, style, <span class="hljs-keyword">this</span>.options.pad);
    <span class="hljs-keyword">this</span>.renderFailureDetails();
    <span class="hljs-keyword">if</span> (save) {
        <span class="hljs-keyword">this</span>.saveResults(save);
    }
    <span class="hljs-keyword">if</span> (exit === <span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">"exit"</span>);
        <span class="hljs-keyword">this</span>.casper.exit(status ? ~~status : exitStatus);
    }
};

<span class="hljs-comment">/**
 * Runs all suites contained in the paths passed as arguments.
 *
 */</span>
Tester.prototype.runSuites = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runSuites</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> testFiles = [], self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CasperError(<span class="hljs-string">"runSuites() needs at least one path argument"</span>);
    }
    <span class="hljs-keyword">this</span>.loadIncludes.includes.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_forEachInclude</span>(<span class="hljs-params">include</span>) </span>{
        phantom.injectJs(include);
    });
    <span class="hljs-keyword">this</span>.loadIncludes.pre.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_forEachPreTest</span>(<span class="hljs-params">preTestFile</span>) </span>{
        testFiles = testFiles.concat(preTestFile);
    });
    <span class="hljs-built_in">Array</span>.prototype.forEach.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_forEachArgument</span>(<span class="hljs-params">path</span>) </span>{
        <span class="hljs-keyword">if</span> (!fs.exists(path)) {
            self.bar(f(<span class="hljs-string">"Path %s doesn't exist"</span>, path), <span class="hljs-string">"RED_BAR"</span>);
        }
        <span class="hljs-keyword">if</span> (fs.isDirectory(path)) {
            testFiles = testFiles.concat(self.findTestFiles(path));
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fs.isFile(path)) {
            testFiles.push(path);
        }
    });
    <span class="hljs-keyword">this</span>.loadIncludes.post.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_forEachPostTest</span>(<span class="hljs-params">postTestFile</span>) </span>{
        testFiles = testFiles.concat(postTestFile);
    });
    <span class="hljs-keyword">if</span> (testFiles.length === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.bar(f(<span class="hljs-string">"No test file found in %s, terminating."</span>,
                   <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>)), <span class="hljs-string">"RED_BAR"</span>);
        <span class="hljs-keyword">this</span>.casper.exit(<span class="hljs-number">1</span>);
    }
    self.currentSuiteNum = <span class="hljs-number">0</span>;
    self.currentTestStartTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
    self.lastAssertTime = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> interval = setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_check</span>(<span class="hljs-params">self</span>) </span>{
        <span class="hljs-keyword">if</span> (self.running) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (self.currentSuiteNum === testFiles.length || self.aborted) {
            self.emit(<span class="hljs-string">'tests.complete'</span>);
            clearInterval(interval);
            self.aborted = <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">else</span> {
            self.runTest(testFiles[self.currentSuiteNum]);
            self.currentSuiteNum++;
        }
    }, <span class="hljs-number">20</span>, <span class="hljs-keyword">this</span>);
};

<span class="hljs-comment">/**
 * Runs a test file
 *
 */</span>
Tester.prototype.runTest = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runTest</span>(<span class="hljs-params">testFile</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">this</span>.bar(f(<span class="hljs-string">'Test file: %s'</span>, testFile), <span class="hljs-string">'INFO_BAR'</span>);
    <span class="hljs-keyword">this</span>.running = <span class="hljs-literal">true</span>; <span class="hljs-comment">// this.running is set back to false with done()</span>
    <span class="hljs-keyword">this</span>.executed = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.exec(testFile);
};

<span class="hljs-comment">/**
 * Terminates current suite.
 *
 */</span>
Tester.prototype.terminate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">if</span> (message) {
        <span class="hljs-keyword">this</span>.casper.warn(message);
    }
    <span class="hljs-keyword">this</span>.done();
    <span class="hljs-keyword">this</span>.aborted = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'tests.complete'</span>);
};

<span class="hljs-comment">/**
 * Saves results to file.
 *
 * @param  String  filename  Target file path.
 */</span>
Tester.prototype.saveResults = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">saveResults</span>(<span class="hljs-params">filepath</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> exporter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'xunit'</span>).create();
    exporter.setResults(<span class="hljs-keyword">this</span>.suiteResults);
    <span class="hljs-keyword">try</span> {
        fs.write(filepath, exporter.getSerializedXML(), <span class="hljs-string">'w'</span>);
        <span class="hljs-keyword">this</span>.casper.echo(f(<span class="hljs-string">'Result log stored in %s'</span>, filepath), <span class="hljs-string">'INFO'</span>, <span class="hljs-number">80</span>);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">this</span>.casper.echo(f(<span class="hljs-string">'Unable to write results to %s: %s'</span>, filepath, e), <span class="hljs-string">'ERROR'</span>, <span class="hljs-number">80</span>);
    }
};

<span class="hljs-comment">/**
 * Tests equality between the two passed arguments.
 *
 * @param  Mixed  v1
 * @param  Mixed  v2
 * @param  Boolean
 */</span>
Tester.prototype.testEquals = Tester.prototype.testEqual = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testEquals</span>(<span class="hljs-params">v1, v2</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> utils.equals(v1, v2);
};

<span class="hljs-comment">/**
 * Processes an error caught while running tests contained in a given test
 * file.
 *
 * @param  Error|String  error      The error
 * @param  String        file       Test file where the error occurred
 * @param  Number        line       Line number (optional)
 * @param  Array         backtrace  Error stack trace (optional)
 */</span>
Tester.prototype.uncaughtError = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uncaughtError</span>(<span class="hljs-params">error, file, line, backtrace</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>XXX: this is NOT an assertion scratch that</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.processAssertionResult({
        <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">type</span>: <span class="hljs-string">"uncaughtError"</span>,
        <span class="hljs-attr">file</span>: file,
        <span class="hljs-attr">line</span>: ~~line,
        <span class="hljs-attr">message</span>: utils.isObject(error) ? error.message : error,
        <span class="hljs-attr">values</span>: {
            <span class="hljs-attr">error</span>: error,
            <span class="hljs-attr">stack</span>: backtrace
        }
    });
};

<span class="hljs-comment">/**
 * Test suites array.
 *
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TestSuiteResult</span>(<span class="hljs-params"></span>) </span>{}
TestSuiteResult.prototype = [];
exports.TestSuiteResult = TestSuiteResult;

<span class="hljs-comment">/**
 * Returns the number of tests.
 *
 * @return Number
 */</span>
TestSuiteResult.prototype.countTotal = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">countTotal</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.countPassed() + <span class="hljs-keyword">this</span>.countFailed() + <span class="hljs-keyword">this</span>.countDubious();
};

<span class="hljs-comment">/**
 * Returns the number of dubious results.
 *
 * @return Number
 */</span>
TestSuiteResult.prototype.countDubious = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">countDubious</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        <span class="hljs-keyword">return</span> result.dubious;
    }).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> a + b;
    }, <span class="hljs-number">0</span>);
};

<span class="hljs-comment">/**
 * Returns the number of executed tests.
 *
 * @return Number
 */</span>
TestSuiteResult.prototype.countExecuted = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">countTotal</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.countTotal() - <span class="hljs-keyword">this</span>.countDubious();
};

<span class="hljs-comment">/**
 * Returns the number of errors.
 *
 * @return Number
 */</span>
TestSuiteResult.prototype.countErrors = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">countErrors</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        <span class="hljs-keyword">return</span> result.crashed;
    }).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> a + b;
    }, <span class="hljs-number">0</span>);
};

<span class="hljs-comment">/**
 * Returns the number of failed tests.
 *
 * @return Number
 */</span>
TestSuiteResult.prototype.countFailed = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">countFailed</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        <span class="hljs-keyword">return</span> result.failed - result.dubious;
    }).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> a + b;
    }, <span class="hljs-number">0</span>);
};

<span class="hljs-comment">/**
 * Returns the number of succesful tests.
 *
 * @return Number
 */</span>
TestSuiteResult.prototype.countPassed = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">countPassed</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        <span class="hljs-keyword">return</span> result.passed;
    }).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> a + b;
    }, <span class="hljs-number">0</span>);
};

<span class="hljs-comment">/**
 * Returns the number of skipped tests.
 *
 * @return Number
 */</span>
TestSuiteResult.prototype.countSkipped = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">countSkipped</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        <span class="hljs-keyword">return</span> result.skipped;
    }).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> a + b;
    }, <span class="hljs-number">0</span>);
};

<span class="hljs-comment">/**
 * Returns the number of warnings.
 *
 * @return Number
 */</span>
TestSuiteResult.prototype.countWarnings = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">countWarnings</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        <span class="hljs-keyword">return</span> result.warned;
    }).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> a + b;
    }, <span class="hljs-number">0</span>);
};

<span class="hljs-comment">/**
 * Checks if the suite has failed.
 *
 * @return Number
 */</span>
TestSuiteResult.prototype.isFailed = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isFailed</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.countErrors() + <span class="hljs-keyword">this</span>.countFailed() + <span class="hljs-keyword">this</span>.countDubious() &gt; <span class="hljs-number">0</span>;
};

<span class="hljs-comment">/**
 * Checks if the suite has skipped tests.
 *
 * @return Number
 */</span>
TestSuiteResult.prototype.isSkipped = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isSkipped</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.countSkipped() &gt; <span class="hljs-number">0</span>;
};

<span class="hljs-comment">/**
 * Returns all failures from this suite.
 *
 * @return Array
 */</span>
TestSuiteResult.prototype.getAllFailures = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAllFailures</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> failures = [];
    <span class="hljs-keyword">this</span>.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        failures = failures.concat(result.failures);
    });
    <span class="hljs-keyword">return</span> failures;
};

<span class="hljs-comment">/**
 * Returns all succesful tests from this suite.
 *
 * @return Array
 */</span>
TestSuiteResult.prototype.getAllPasses = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAllPasses</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> passes = [];
    <span class="hljs-keyword">this</span>.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        passes = passes.concat(result.passes);
    });
    <span class="hljs-keyword">return</span> passes;
};

<span class="hljs-comment">/**
 * Returns all skipped tests from this suite.
 *
 * @return Array
 */</span>
TestSuiteResult.prototype.getAllSkips = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAllSkips</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> skipped = [];
    <span class="hljs-keyword">this</span>.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        skipped = skipped.concat(result.skipped);
    });
    <span class="hljs-keyword">return</span> skipped;
};

<span class="hljs-comment">/**
 * Returns all results from this suite.
 *
 * @return Array
 */</span>
TestSuiteResult.prototype.getAllResults = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAllResults</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getAllPasses().concat(<span class="hljs-keyword">this</span>.getAllFailures());
};

<span class="hljs-comment">/**
 * Computes the sum of all durations of the tests which were executed in the
 * current suite.
 *
 * @return Number
 */</span>
TestSuiteResult.prototype.calculateDuration = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculateDuration</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getAllResults().map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        <span class="hljs-keyword">return</span> ~~result.time;
    }).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> a + b;
    }, <span class="hljs-number">0</span>);
};

<span class="hljs-comment">/**
 * Test suite results object.
 *
 * @param Object  options
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TestCaseResult</span>(<span class="hljs-params">options</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">this</span>.name = options &amp;&amp; options.name;
    <span class="hljs-keyword">this</span>.file = options &amp;&amp; options.file;
    <span class="hljs-keyword">this</span>.planned = ~~(options &amp;&amp; options.planned) || <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>.errors = [];
    <span class="hljs-keyword">this</span>.failures = [];
    <span class="hljs-keyword">this</span>.passes = [];
    <span class="hljs-keyword">this</span>.skips = [];
    <span class="hljs-keyword">this</span>.warnings = [];
    <span class="hljs-keyword">this</span>.config = options &amp;&amp; options.config;
    <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"assertions"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.passed + <span class="hljs-keyword">this</span>.failed;
    });
    <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"crashed"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.errors.length;
    });
    <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"failed"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.failures.length;
    });
    <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"dubious"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.failures.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">failure</span>) </span>{
            <span class="hljs-keyword">return</span> failure.type === <span class="hljs-string">"dubious"</span>;
        }).length;
    });
    <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"passed"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.passes.length;
    });
    <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"skipped"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.skips.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">skip</span>) </span>{
            <span class="hljs-keyword">return</span> skip.number;
        }).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
            <span class="hljs-keyword">return</span> a + b;
        }, <span class="hljs-number">0</span>);
    });
}
exports.TestCaseResult = TestCaseResult;

<span class="hljs-comment">/**
 * Adds a failure record and its execution time.
 *
 * @param Object  failure
 * @param Number  time
 */</span>
TestCaseResult.prototype.addFailure = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addFailure</span>(<span class="hljs-params">failure, time</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    failure.suite = <span class="hljs-keyword">this</span>.name;
    failure.time = time;
    <span class="hljs-keyword">this</span>.failures.push(failure);
};

<span class="hljs-comment">/**
 * Adds an error record.
 *
 * @param Object  failure
 */</span>
TestCaseResult.prototype.addError = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addFailure</span>(<span class="hljs-params">error</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    error.suite = <span class="hljs-keyword">this</span>.name;
    <span class="hljs-keyword">this</span>.errors.push(error);
};

<span class="hljs-comment">/**
 * Adds a success record and its execution time.
 *
 * @param Object  success
 * @param Number  time
 */</span>
TestCaseResult.prototype.addSuccess = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSuccess</span>(<span class="hljs-params">success, time</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    success.suite = <span class="hljs-keyword">this</span>.name;
    success.time = time;
    <span class="hljs-keyword">this</span>.passes.push(success);
};

<span class="hljs-comment">/**
 * Adds a success record and its execution time.
 *
 * @param Object  success
 * @param Number  time
 */</span>
TestCaseResult.prototype.addSkip = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSkip</span>(<span class="hljs-params">skipped, time</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    skipped.suite = <span class="hljs-keyword">this</span>.name;
    skipped.time = time;
    <span class="hljs-keyword">this</span>.skips.push(skipped);
};


<span class="hljs-comment">/**
 * Adds a warning message.
 * <span class="hljs-doctag">NOTE:</span> quite contrary to addError, addSuccess, and addSkip
 * this adds a String value, NOT an Object
 *
 * @param String  warning
 */</span>
TestCaseResult.prototype.addWarning = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addWarning</span>(<span class="hljs-params">warning</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">this</span>.warnings.push(warning);
};

<span class="hljs-comment">/**
 * Computes total duration for this suite.
 *
 * @return  Number
 */</span>
TestCaseResult.prototype.calculateDuration = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculateDuration</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a, b</span>) </span>{
        <span class="hljs-keyword">return</span> a + b;
    }
    <span class="hljs-keyword">var</span> passedTimes = <span class="hljs-keyword">this</span>.passes.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">success</span>) </span>{
        <span class="hljs-keyword">return</span> ~~success.time;
    }).reduce(add, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">var</span> failedTimes = <span class="hljs-keyword">this</span>.failures.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">failure</span>) </span>{
        <span class="hljs-keyword">return</span> ~~failure.time;
    }).reduce(add, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> passedTimes + failedTimes;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
